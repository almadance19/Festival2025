<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>Multi-Participant Dance Competition Scoring</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 30px;
    }
    .form-container {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .judge-info {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    .judge-info div {
      flex: 1;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .participant-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .participant-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      background-color: #fff;
    }
    .participant-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    .participant-number {
      font-weight: bold;
      font-size: 18px;
    }
    .score-input {
      width: 60px;
      text-align: center;
      margin: 5px 0;
    }
    .participant-total {
      font-weight: bold;
      text-align: center;
      margin-top: 10px;
      padding: 5px;
      background-color: #f8f9fa;
      border-radius: 4px;
    }
    .submit-btn {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 30px;
      width: 100%;
    }
    .submit-btn:hover {
      background-color: #2980b9;
    }
    #message {
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
    }
    .success { color: green; }
    .error { color: red; }
    .add-participant {
      background-color: #2ecc71;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 20px;
    }
    .add-participant:hover {
      background-color: #27ae60;
    }

    .info { color: blue; }

    /* Add this if you want the dialog buttons to match your existing style */
    #confirmSubmit, #confirmCancel {
    transition: background-color 0.3s;
    }

    #confirmSubmit:hover {
    background-color: #27ae60 !important;
    }

    #confirmCancel:hover {
    background-color: #c0392b !important;
    }
    }
  </style>
</head>
<body>
    <div class="form-container">
      <h1>Multi-Participant Dance Competition Scoring</h1>
      
      <div class="judge-info">
        <div>
          <label for="judgeName">Judge Name:</label>
          <input type="text" id="judgeName" required>
        </div>
        <div>
          <label for="category">Category:</label>
          <select id="category" required>
            <option value="">Select Category</option>
            <option value="Leader">Leader</option>
            <option value="Follower">Follower</option>
          </select>
        </div>
        <div>
          <label for="round">Round:</label>
          <select id="round" required>
            <option value="">Select Round</option>
            <option value="Preliminary">Preliminary</option>
            <option value="Semifinal">Semifinal</option>
            <option value="Final">Final</option>
          </select>
        </div>
      </div>
      
      <button class="add-participant" onclick="addParticipant()">Add Participant</button>
      
      <div class="participant-container" id="participantsContainer">
        <!-- Participant cards will be added here -->
      </div>
      
      <button class="submit-btn" onclick="submitAllScores()">Submit All Scores</button>
      
      <div id="message"></div>
    </div>
  
    <script>
      // Same participant management code as before
      let participantCount = 0;
      const maxParticipants = 24;
      
      // URL of your published Google Apps Script web app
      const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwEGGgsIuPLmDc9ERdAsMD41P23WumXwiob65dmNViwGSD4i8UgNV7WGffY2n6dBo4/exec';
      
      document.addEventListener('DOMContentLoaded', function() {
        addParticipant();
      });
      
      function addParticipant() {
        if (participantCount >= maxParticipants) {
          alert(`Maximum of ${maxParticipants} participants reached`);
          return;
        }
        
        participantCount++;
        const container = document.getElementById('participantsContainer');
        
        const card = document.createElement('div');
        card.className = 'participant-card';
        card.id = `participant-${participantCount}`;
        
        card.innerHTML = `
          <div class="participant-header">
            <span class="participant-number">Participant #${participantCount}</span>
            <button onclick="removeParticipant(${participantCount})" style="color: red; border: none; background: none; cursor: pointer;">Ã—</button>
          </div>
        <div>
        <label>Number/ID:</label>
        <input type="text" id="coupleNumber-${participantCount}" value="${participantCount}" required>
        </div>
          <div>
            <label>Creativity (1-10):</label>
            <input type="number" id="creativity-${participantCount}" class="score-input" min="1" max="10" required onchange="calculateTotal(${participantCount})">
          </div>
          <div>
            <label>Expression (1-10):</label>
            <input type="number" id="expression-${participantCount}" class="score-input" min="1" max="10" required onchange="calculateTotal(${participantCount})">
          </div>
          <div>
            <label>Connection (1-10):</label>
            <input type="number" id="connection-${participantCount}" class="score-input" min="1" max="10" required onchange="calculateTotal(${participantCount})">
          </div>
          <div>
            <label>Musicality (1-10):</label>
            <input type="number" id="musicality-${participantCount}" class="score-input" min="1" max="10" required onchange="calculateTotal(${participantCount})">
          </div>
          <div>
            <label>Technique (1-10):</label>
            <input type="number" id="technique-${participantCount}" class="score-input" min="1" max="10" required onchange="calculateTotal(${participantCount})">
          </div>
          <div class="participant-total">
            Total: <span id="total-${participantCount}">0</span>
          </div>
        `;
        
        container.appendChild(card);
      }
      
      function removeParticipant(id) {
        if (participantCount <= 1) {
          alert("You must have at least one participant");
          return;
        }
        
        const card = document.getElementById(`participant-${id}`);
        card.remove();
        participantCount--;
        
        // Renumber remaining participants
        const cards = document.querySelectorAll('.participant-card');
        cards.forEach((card, index) => {
          const newNumber = index + 1;
          card.querySelector('.participant-number').textContent = `Participant #${newNumber}`;
          card.id = `participant-${newNumber}`;
        });
      }
      
      function calculateTotal(participantId) {
        const creativity = parseInt(document.getElementById(`creativity-${participantId}`).value) || 0;
        const expression = parseInt(document.getElementById(`expression-${participantId}`).value) || 0;
        const connection = parseInt(document.getElementById(`connection-${participantId}`).value) || 0;
        const musicality = parseInt(document.getElementById(`musicality-${participantId}`).value) || 0;
        const technique = parseInt(document.getElementById(`technique-${participantId}`).value) || 0;
        
        const total = creativity + expression + connection + musicality + technique;
        document.getElementById(`total-${participantId}`).textContent = total;
      }
      
      async function submitAllScores() {

        // First show confirmation dialog
  const isConfirmed = await showConfirmationDialog();
  if (!isConfirmed) {
    showMessage("Submission cancelled", "info");
    return;
  }
    // Get judge information
  const judgeName = document.getElementById('judgeName').value;
  const category = document.getElementById('category').value;
  const round = document.getElementById('round').value;
  
  // Validate inputs
  if (!judgeName || !category || !round) {
    showMessage("Please fill all judge information fields", "error");
    return;
  }
  
  // Collect all participant scores
  const scores = [];
  for (let i = 1; i <= participantCount; i++) {
    if (!document.getElementById(`participant-${i}`)) continue;
    
    scores.push({
      coupleNumber: document.getElementById(`coupleNumber-${i}`).value,
      creativity: document.getElementById(`creativity-${i}`).value,
      expression: document.getElementById(`expression-${i}`).value,
      connection: document.getElementById(`connection-${i}`).value,
      musicality: document.getElementById(`musicality-${i}`).value,
      technique: document.getElementById(`technique-${i}`).value,
      totalScore: parseInt(document.getElementById(`total-${i}`).textContent)
    });
  }
  
  // Prepare URL parameters
  const params = new URLSearchParams();
  params.append('judgeName', judgeName);
  params.append('category', category);
  params.append('round', round);
  params.append('scores', JSON.stringify(scores));
  
  try {
    const response = await fetch(SCRIPT_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: params
    });
    
    const result = await response.json();
    
    if (result.success) {
      showMessage(result.message, "success");
      // Optional: Reset form after successful submission
    } else {
      showMessage("Error: " + result.message, "error");
    }
  } catch (error) {
    showMessage("Failed to submit scores: " + error.message, "error");
  }
}
        // Function to show messages
      function showMessage(text, type) {
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = text;
        messageDiv.className = type;
      }

      function showConfirmationDialog() {
  return new Promise((resolve) => {
    // Create dialog elements
    const dialog = document.createElement('div');
    dialog.style.position = 'fixed';
    dialog.style.top = '0';
    dialog.style.left = '0';
    dialog.style.width = '100%';
    dialog.style.height = '100%';
    dialog.style.backgroundColor = 'rgba(0,0,0,0.5)';
    dialog.style.display = 'flex';
    dialog.style.justifyContent = 'center';
    dialog.style.alignItems = 'center';
    dialog.style.zIndex = '1000';

    const dialogContent = document.createElement('div');
    dialogContent.style.backgroundColor = 'white';
    dialogContent.style.padding = '20px';
    dialogContent.style.borderRadius = '8px';
    dialogContent.style.maxWidth = '500px';
    dialogContent.style.width = '80%';

    dialogContent.innerHTML = `
      <h3 style="margin-top: 0;">Confirm Score Submission</h3>
      <p>You are about to submit scores for ${participantCount} participants.</p>
      <p>Please review all scores before confirming.</p>
      <div style="display: flex; justify-content: space-between; margin-top: 20px;">
        <button id="confirmCancel" style="padding: 8px 16px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
        <button id="confirmSubmit" style="padding: 8px 16px; background: #2ecc71; color: white; border: none; border-radius: 4px; cursor: pointer;">Submit Scores</button>
      </div>
    `;

    dialog.appendChild(dialogContent);
    document.body.appendChild(dialog);

    // Handle button clicks
    document.getElementById('confirmSubmit').addEventListener('click', () => {
      document.body.removeChild(dialog);
      resolve(true);
    });

    document.getElementById('confirmCancel').addEventListener('click', () => {
      document.body.removeChild(dialog);
      resolve(false);
    });
  });
}

    </script>
  </body>
</html>